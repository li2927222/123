{include file="public:header" /}
<link rel="stylesheet" href="__CSS__/childorder.css">
<style>
	input{
		border: 0;
		outline: none;
		width: 80px;
	}
	#info_origin {
		width: 100px;
	}
	.do {
		width: 80px;
	}
	#div-table-phone {
		position:relative;
		left: 0;
		top: 0;
	    bottom: 0;
	    right: 0;
	    margin: auto;
	    width: 99%;
	}
	#select-phone {
		width: 200px;
		height: 30px;
		margin: 0;
		padding: 0;
	}

</style>
{include file="public:menu" /}
<form id="a" action="{:url('Orderfind/SubmitAmend')}" method="post" autocomplete="off" enctype="multipart/form-data">
<div id="warpper">
	
	<!-- 下面是订单表头基本信息 -->
	<div class="div-table">
		
		<table class="table table-bordered table-hover text-nowrap">
			<thead>
				<h4><b>
					<a class="btn btn-default" href="javascript:history.back(-1)"><span class="glyphicon glyphicon-arrow-left"></span> 返回</a>
					<br>
					<br>
				订单详情</b></h4>
				<th class="info">订单号</th>
				<th class="info">订单名称</th>
				<th class="info">使用单位</th>
				<th class="info">信息来源</th>
				<th class="info">信息备注</th>
				<th class="info">所属区域</th>
				<th class="info">操作人</th>
				<th class="info">生成时间</th>
			</thead>
			<tbody>
				<tr>
					<td><input type="text" name="order_id" value="{$order_info.0.order_id}" readonly="readonly"></td>
					<td><input type="text" name="order_name" value="{$order_info.0.order_name}"></td>
					<td><input type="text" name="user_company" value="{$order_info.0.user_company}"></td>
					<td>
						<select name="info_origin" id="info_origin" class="btn btn-default">
							<option value="{$order_info.0.info_origin}">{$order_info.0.info_origin}</option>
							<option value="运营商">运营商</option>
							<option value="软件商">软件商</option>
							<option value="平台商">平台商</option>
							<option value="其他">其他</option>
						</select>
					</td>
					<td><input type="text" name="info_remark" value="{$order_info.0.info_remark}"></td>
					<td><input type="text" name="area" value="{$order_info.0.area}" readonly="readonly"></td>
					<td><input type="text" name="operator" value="{$order_info.0.operator}" readonly="readonly"></td>
					<td><input type="text" name="order_creat_time" value="{$order_info.0.order_creat_time}" readonly="readonly"></td>
				</tr>
			</tbody>
		</table>
	</div>

	<!-- 下面是关键人表格信息 -->
	<div class="div-table">
		<table id="tab-linkman" class="table table-bordered table-hover text-nowrap">
			<thead>
				<h4>
					<b>关键人</b>
					<a href="#" class="btn btn-success" id="add-linkman">+添加关键人</a>
					<a href="#" class="btn btn-danger" id="del-linkman">x删除最后一行</a>
				</h4>
				<th class="info">ID</th>
				<th class="info">姓名</th>
				<th class="info">性别</th>
				<th class="info">电话</th>
				<th class="info">岗位</th>
				<th class="info">职能</th>
				<th class="info">作用</th>
				<th class="info">操作</th>
			</thead>
			<tbody>
					{volist name="linkman" id='lo'}
					<tr>
						<td><input type="text" name="linkman_id[]" value="{$lo.id}" readonly="readonly"></td>
						<td><input type="text" name="linkman_name[]" value="{$lo.name}"></td>
						<td><input type="text" name="linkman_sex[]" value="{$lo.sex}"></td>
						<td><input type="text" name="linkman_phone[]" value="{$lo.phone}" maxlength="11"></td>
						<td><input type="text" name="linkman_position[]" value="{$lo.position}"></td>
						<td><input type="text" name="linkman_function[]" value="{$lo.function}"></td>
						<td><input type="text" name="linkman_effect[]" value="{$lo.effect}"></td>
						<td>
							<select name="do_linkman[]" id="" class="btn btn-default do">
								<option value="0">无</option>
								<option value="1">删除</option>
								<option value="2">修改</option>
								<option value="3">增加</option>
							</select>
						</td>
					</tr>
					{/volist}
			</tbody>
		</table>
	</div>

	<!-- 下面是助推联系人基本信息 -->
	<div class="div-table">
			<table id="tab-booster" class="table table-bordered table-hover text-nowrap">
				<thead>
					<h4>
						<b>助推人</b>
						<a href="#" class="btn btn-success" id="add-booster">+添加助推人</a>
						<a href="#" class="btn btn-danger" id="del-booster">x删除最后一行</a>
					</h4>
					<th class="info">ID</th>
					<th class="info">姓名</th>
					<th class="info">性别</th>
					<th class="info">电话</th>
					<th class="info">岗位</th>
					<th class="info">职能</th>
					<th class="info">作用</th>
					<th class="info">操作</th>
				</thead>
				<tbody>
						{volist name="booster" id='bo'}
						<tr>
							<td><input type="text" name="booster_id[]" value="{$bo.id}" readonly="readonly"></td>
							<td><input type="text" name="booster_name[]" value="{$bo.name}"></td>
							<td><input type="text" name="booster_sex[]" value="{$bo.sex}"></td>
							<td><input type="text" name="booster_phone[]" value="{$bo.phone}" maxlength="11"></td>
							<td><input type="text" name="booster_position[]" value="{$bo.position}"></td>
							<td><input type="text" name="booster_function[]" value="{$bo.function}"></td>
							<td><input type="text" name="booster_effect[]" value="{$bo.effect}"></td>
							<td>
							<select name="do_booster[]" id="" class="btn btn-default do">
								<option value="0">无</option>
								<option value="1">删除</option>
								<option value="2">修改</option>
								<option value="3">增加</option>
							</select>
						</td>
						</tr>
						{/volist}
				</tbody>
			</table>
		</div>

	<div id="div-table-phone">
			<table id="tab-phone" class="table table table-bordered table-hover text-nowrap" >
				<thead>
					<h4>
						<b>子订单详情</b>
						<a href="#" class="btn btn-success" id="add-phone">+添加机型</a>
						<a href="#" class="btn btn-danger" id="del-phone">x删除最后一行</a>
					</h4>
				</thead>
				<tbody>	
					<tr>
						<td class="info">ID</td>
						<td class="info">批次</td>
						<td class="info">手机型号</td>
						<td class="info">数量</td>
						<td class="info">落地价</td>
						<td class="info">单台费用</td>
						<td class="info">运营商结算</td>
						<td class="info">机型+套餐</td>
						<td class="info">竞品</td>
						<td class="info">赢单因素</td>
						<td class="info">使用用途</td>
						<td class="info">落地时间</td>
						<td class="info">换购时间</td>
						<td class="info">操作</td>
					</tr>
					{volist name="order_info" id='vo'}
					<tr>
						<td><input type="text" name="phone_id[]" value="{$vo.id}" readonly="readonly"></td>
						<td><input type="text" name="batch[]" value="{$vo.batch}" readonly="readonly" maxlength="5" ></td>
						<td>
							<select name="phone[]" id="select-phone" class="btn btn-default">
								<option value="{$vo.WaresID}">{$vo.WaresName} {$vo.ColorName}</option>
								{volist name="phone" id="po"}
									<option value="{$po.WaresID}">
										{$po.WaresName} {$po.ColorName}
									</option>
								{/volist}
							</select>
						</td>
						<td><input type="number" name="phone_count[]" value="{$vo.phone_count}"></td>
						<td><input type="text" name="phone_price[]" value="{$vo.phone_price}"></td>
						<td><input type="text" name="phone_cost[]" value="{$vo.phone_cost}"></td>
						<td><input type="text" name="is_operator[]" value="{$vo.is_operator}" maxlength="200"></td>
						<td><input type="text" name="combinedbag[]" value="{$vo.combinedbag}" maxlength="200"></td>
						<td><input type="text" name="competitor[]" value="{$vo.competitor}"></td>
						<td><input type="text" name="winning_factors" value="{$vo.winning_factors}" maxlength="200"></td>
						<td><input type="text" name="usage[]" value="{$vo.usage}" maxlength="200"></td>
						<td>
							<input id="time_landing" name="time_landing[]" type="text" value="{$vo.time_landing}" onClick="WdatePicker()"/>
						</td>
						<td>
							<input id="time_exchange" name="time_exchange[]" type="text" value="{$vo.time_exchange}" onClick="WdatePicker()"/>
						</td>
						<td>
								<select name="do_phone[]"  class="btn btn-default do">
									<option value="0">无</option>
									<option value="1">删除</option>
									<option value="2">修改</option>
									<option value="3">新增</option>
								</select>
							</td>
					</tr>
					{/volist}
				</tbody>
					 
			</table>
			
			<p style="text-align: center;">
				<button type="submit" id="button" class="btn btn-success">保存</button>
				&nbsp;&nbsp;
				<button type="button" id="cancel" class="btn btn-info">重置</button>
			</p>
		</div>
</div>
</form>

{include file="public:footer" /}
<script type="text/javascript" src="__JS__/DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="__JS__/amendorder.js"></script>
<script type="text/javascript">
	var len_phone = $("#tab-phone tr").length;
	//点击添加机型
	$("#add-phone").click(function(){
		var add_info = '<tr>'+
						'<td><input name="phone_id[]" type="text" placeholder="这里不用填" readonly="readonly"></td>'+
						'<td><input name="batch[]" type="text" maxlength="5"></td>'+
						'<td>'+
							'<select name="phone[]" id="select-phone" class="btn btn-default">'+
								'{volist name="phone" id="po"}'+
									'<option value="{$po.WaresID}">'+
										'{$po.WaresName} {$po.ColorName}'+
									'</option>'+
								'{/volist}'+
							'</select>'+
						'</td>'+
						'<td><input type="number" name="phone_count[]"></td>'+
						'<td><input type="text" name="phone_price[]" ></td>'+
						'<td><input type="text" name="phone_cost[]" ></td>'+
						'<td><input type="text" name="is_operator[]"  maxlength="200"></td>'+
						'<td><input type="text" name="combinedbag[]"  maxlength="200"></td>'+
						'<td><input type="text" name="competitor[]" ></td>'+
						'<td><input type="text" name="winning_factors" value="{$vo.winning_factors}" maxlength="200"></td>'+
						'<td><input type="text" name="usage[]" maxlength="200"></td>'+
						'<td>'+
							'<input id="time_landing" name="time_landing[]" type="text"  onClick="WdatePicker()"/>'+
						'</td>'+
						'<td>'+
							'<input id="time_exchange" name="time_exchange[]" type="text"  onClick="WdatePicker()"/>'+
						'</td>'+
						'<td>'+
								'<select name="do_phone[]"  class="btn btn-default do">'+
									'<option value="0">无</option>'+
									'<option value="1">删除</option>'+
									'<option value="2">修改</option>'+
									'<option value="3">新增</option>'+
							'	</select>'+
							'</td>'+
					'</tr>';
		$("#tab-phone").append(add_info);
	});//add-phone click function
	$("#del-phone").click(function(){
		//判断当前phone表格中tr的行数是否大于页面初始化时的行数
		//如果大于则为手动添加过的行数可以删除
		//否则视为没有手动添加过，提示不能删除原始数据
		if($("#tab-phone tr").length > len_phone){
			$("#tab-phone tr:last").remove();
		}else{
			alert("不能删除已有数据");
		}
	});
</script>